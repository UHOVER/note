### ISO/OSI 七层模型 ###	
7-应用层			APDU(提供接口)	
6-表示层			PPDU(数据表示，翻译成机器语言，压缩加密)	
5-会话层			SPDU(判断会不会发送网络传递)	
4-传输层			TPDU(传输协议，TCP[可靠]、UDP[不可靠]，确定发送和接收端口号)	
3-网络层			报文(确定 IP 地址，发送方接收方的IP。选路)	
2-数据链路层      帧 (包含计算机的网卡的硬件地址 MAC地址。源MAC地址和目标MAC地址。通过一个局域网跳到另一个局域网)	
1-物理层         比特( 01)	

上三层给用户提供用户服务，下四层是实际的数据传递的	
MAC 地址负责局域网通信	
IP 地址负责外网通信	

### TCP/IP 四层模型 ###
应用层 		->[应用层\表示层\会话层]	为用户提供所需要的各种服务，例如：FTP、Telnet、DNS、SMTP
传输层 		->[传输层]				为应用层提供端到端的通信功能，保证数据包的顺序传递及数据的完整行。TCP、UDP[发送端口和接收端口]	
网际互联层 	->[网络层]				主要解决主机到主机的通讯问题。数据包在整个网络上的传输逻辑。有三个主要协议：IP、IGMP、ICMP   
网络接口层 	->[数据链路层\物理层]		负责监视数据在主机和网络之间的交换。地址解析协议(ARP)工作在此层

也有说法是: TCP/IP 五层模型
网络接口层 <=> 数据链路层、物理层

arp 把IP地址翻译成网卡物理地址($arp -a //解析当前计算机有联系的IP地址和对应的MAC地址)			
IP地址：跨网段、公网、互联网 数据传递需要考IP地址进行传递	
MAC地址：如果在局域网、同一个网段之内，传递数据是靠MAC地址(物理地址) 
同一局域网发送数据流程：发送-> 发到网线-> 发到交换机(只能识别 MAC 地址) -> 判断   

TCP/IP 三次握手(信息错误，会重新传送)
发送SYN信息(序列号=x)		            ->		接收SYN信息(序列号=x)
接收SYN、ACK信息(序列号=y,确认号=x+1)	<-	    发送SYN、ACK信息(序列号=y,确认号=x+1)
发送ACK信息(确认号=y+1)	            ->		接收ACK信息(确认号=y+1)

数据封装和解封过程
应用数据												 |字节流(数据)|
应用层 										   |FTP头|字节流(数据)|
传输层 									  |TCP头|FTP头|字节流(数据)|
网络层  								 |IP头|TCP头|FTP头|字节流(数据)|
数据链路层  					  |以太帧头|IP头|TCP头|FTP头|字节流(数据)|

网络上的数据			|以太帧头|目的地址|源地址|包类型|包数据|CRC
包数据=[|IP头|TCP头|FTP头|字节流(数据)|]


### IP 地址 ###
IP包头？
IPV4 没有 IPV6 快的原因是 IPV4 的 IP包头长度不固定的，接收到数据包要先去检查

IP 地址
2^32
二进制
00000000.00000000.00000000.00000000
11111111.11111111.11111111.11111111
换成10进制
0.0.0.0
255.255.255.255
ip地址分类
---------------------------------------------------------------------------------------------------
网络类型 |	最大网络数	|	IP地址范围					| 最大主机数 |	私有IP地址范围
---------------------------------------------------------------------------------------------------
	A   | 126(2^7-2)	| 1.0.0.0--126.255.255.255		| 2^24-2    | 10.0.0.0--10.255.255.255
	B   | 16384(2^14)	| 128.0.0.0--191.255.255.255	| 2^16-2	| 172.16.0.0--173.31.255.255
    C   | 2097152(2^21)	| 192.0.0.0--223.255.255.255	| 2^8-2		| 192.168.0.0--192.168.255.255
---------------------------------------------------------------------------------------------------
D和E 不对民用组织开发 224-225 不在可用范围
127 只有一个网段(127.0.0.1)是代表当前计算机自己，不属于上面几类

不同的网络(网段)需要通信，就要用路由器(跨网络通讯)，同一个网络通信使用交换机就可以了
A类
1.0.0.0 和 2.0.0.0 A 类的第一位不同的数代表不同的网络(网段)
后三个数变化代表同一个网络的不同主机，(当前网段)最大主机数表示后 2^24-2=256*256*256-2(x.0.0.0 & x.255.255.255)
x.0.0.0 代表网络本身(Network ID)，不能分配
x.255.255.255 代表当前网络的广播地址，不能分配

B类
前两个数代表一个网段，后两个数代表当前网段的不同主机

C类
前三个数代表一个网段，后一个数代表当前网段的不同主机

私有IP地址:不需要花钱去购买的,私有IP不能直接访问公网，他们需要和公网IP进行转换才能访问

### 子网掩码(Subnet Mask) ###
ABC类的网段个数和主机个数，是由子网掩码决定的
作用：用来确定 IP 地址当中，哪一个变化代表不同网段，哪一个数代表同一个网段当中的不同主机。跟255对应的IP变化代表不同网段，和0对应代表主机
子网掩码的合理：换算为 二进制所有的1都是连续的，例如：255.0.0.0 255.255.0.0 255.255.255.0 可变化
广播地址:专门用于同时向网络中所有工作站进行发送的一个地址 [代表这个网段的第一个IP]
上面所说的各类IP对应的主机数，都是采用默认的子网掩码，也可以才有非默认子网掩码
IP 和 子网掩码不能单独使用，必要同时使用


变长子网掩码及子网规则
IP地址： 172.16.2.121
子网掩码：255.255.255.0

					网络位	|	网络位	|	子网位	|	主机位
---------------------------------------------------------------------
172.16.2.121  :   10101100	| 00010000	| 00000010	| 01111001
255.255.255.0 :   11111111	| 11111111	| 11111111	| 00000000
---------------------------------------------------------------------
	网络地址	  :	  10101100	| 00010000	| 00000010	| 00000000			
	广播地址	  :	  10101100	| 00010000	| 00000010	| 11111111	

	网络地址 = 172.16.2.0
	主机地址 = 172.16.2.1 -- 172.16.2.254
	广播地址 = 172.16.2.255

网络地址(Network ID)的计算方法：IP地址  &(与运算)  子网掩码
广播地址的计算方式：将子网掩码二进制的0换成1，然后 IP地址  &(与运算)  子网掩码		

说明了并不是 B类 IP 都必须只能分配两个255两个0，也可以随意指定子网掩码，只要是合理即可，上述 172.16.2 为网段，121 为主机，最大的主机数是2^8-2

### 端口 ###
TCP 协议包头？
可以的端口数 2^16，10000以内，给系统用，大于10000给编程用
常见端口号
FTP(文件传输协议): 		端口号 20 21
SSH(安全shell协议): 		端口号 22
telnet(远程登录协议): 		端口号 23(明文不加密)
DNS(域名系统): 			端口号 53
http(超文本传输协议):		端口号 80
SMTP(简单邮件传输协议):	端口号 25(发信)
POP3(邮局协议3代):		端口号 110(收信)

查看本机启用端口
#netstat -an
	-a : 查看所有连接和监听端口
	-n : 显示IP地址和端口号，而不显示域名和服务器名

访问发起者(客户端)的端口是随机端口，访问目标(服务器)的端口是固定端口
state 
LISTEN:监听(UDP没有这个状态)
ESTABLISHED:正在链接

### NDS ###
名称解析
hosts 是做静态IP和域名对应
hosts 文件的优先级是高于 DNS 解析的

DNS服务的作用
1、客户机向 DNS 服务器发送域名查询请求
2、DNS 服务器告知客户机 WEB 服务器的 IP 地址
3、客户机与 WEB 服务器通信

域名用"."分割便于分级管理

DNS 查询类型
查询方式分：
- 递归查询 : 客户端和DNS服务器之间属于递归查询，查询即可以的到成功或失败的响应。客户端向 DNS 服务器发出请求后，若 DNS 服务器本身不能解析，则会向另外的 DNS 服务器发出查询请求，得到结果转交给客户机
- 迭代查询 : DNS 服务器之间属于迭代查询。服务器收到一次迭代查询回复一次结果，结果不一定是目标 IP 或 域名 的映射关系，也可以是其它 DNS 服务器的地址。	
查询内容分
- 正向查询 : 由域名查找 IP 地址
- 反向查询 : 由 IP 地址查询域名

### 网关(GetWay) ###
又称网间连接器、协议转换器；在网络层以上实现网络互连，是最复杂的网络互连设备，仅用于两个高层协议不同的网络互连。
即可以用于广域网互连，也用于局域网互连。是一种充当转换重任的服务器或路由器

MAC 地址是48位
进行局域网的通信

计算机->发送数据报->交换机接收，检查源 MAC 地址，和目标MAC地址
	--> 交换机发现 目标 MAC 在自己管理范围之内，直接发送给目标 MAC 地址->局域网之间的通信
	--> 交换机发现 目标 MAC 地址不在自己管理范围之内，将数据报发送给 网关 -> 网关直接进行传递，数据报交给目标网关 -> 目标网关将数据报交给目标 交换机，交换机交给目标 MAC 地址，然后所在计算机解析数据报 -> 公网之间的通信 

作用：
1、网关在所有内网计算机访问的不是本网段的数据报时使用
2、网关负责将内网 IP 转换为公网 IP，公网 IP 转换为内网 IP
如果是本局域网发送数据报

不配置网关，不配置 DNS 不能访问公网，只能访问局域网
在一台服务器里，连内网的网卡是不能设置网关的


#### Linux 网络配置 #####

1- Linux 配置 IP 地址
DHCP服务器 ： 自动分配 IP 地址的服务器
#service network restart // 重启网络

1-1 ifconfig [临时配置 IP 地址]
*作用： 查看和配置网络状态

#ifconfig // 查看网卡信息
网卡：lo(代表当前计算机自己)，eth0(第一块网卡)

#ifconfig eth0 192.168.1.123 netmask 255.255.255.0 // 临时配置 eth0 网卡的 IP 地址和子网掩码

1-2 setup [永久配置IP地址]
红帽专有的图形化工具
#setup

2- Linux 网络配置文件
修改配置文件
网卡信息文件
# vi /etc/sysconfig/network-scripts/ifcfg-eth0 // eth0 代表第一块网卡
-----------------------------------------------------------------------------------------
DEVICE=eth0   				// 网卡设备名
BOOTPROTO=none				// 是否自动获取IP(none,static,dhcp)
HWADDR=00:0c:29:17:c4:09 	// MAC 地址
ONBOOT=yes 					// 是否随网络服务启动，设置为yes,eth0 生效
TYPWE=Ethernet 				// 类型为以太网
USERCTL=no 					// 不允许非 root 用户控制此网卡
--> 下面的如果BOOTPROTO=dhcp,则会自动生成
NM_CONTROLLED=yes			// 是否可以由Network Manager 图形管理工具托管，没有图形桌面填 no
UUID="xxx" 					// 唯一识别码
IPADDR=192.168.0.1			// IP 地址
NETMASK=255.255.255.0 		// 子网掩码
GATEWAY=192.168.0.1 		// 网关
DNS1=202.106.0.20 			// DNS
IPV6INIT=no 				// IPv6 没有启用
-----------------------------------------------------------------------------------------

主机名文件
# vi /etc/sysconfig/network
-----------------------------------------------------------------------------------------
NETWORKING=yes					// 网络服务是否开启
HOSTNAME=localhost.localdomain  // 主机名，改完后重启计算机
-----------------------------------------------------------------------------------------
# hostname wahhung // 临时更改主机名
# hostname // 查看主机名

DNS 配置文件
# vi /ect/resolv.conf
-----------------------------------------------------------------------------------------
nameserver 202.106.0.20 // DNS，名称服务器,多个可以空格分开，或者再写一行 nameserver
search localhost // 如果输入域名不全，会尝试拼接 xxx.localhost
-----------------------------------------------------------------------------------------

3- 虚拟机网络参数配置
a、修改Linux IP 地址

b、启动网卡
	# vi /etc/sysconfig/network-scripts/ifcfg-eth0
	ONBOOT=yes 
	# service network restart	//重启网络服务

c、修改 UUID [通过镜像复制过来的UUID会重复、冲突]
	# vi /ect/sysconfig/network-scripts/ifcfg-eth0
	# 删除 MAC 地址行
	# rm -rf /etc/udev/rules.d/70-persistent-net.rules
	# 删除网卡和 MAC 地址 绑定
	# 重启系统
d、
	桥接：虚拟机和真实机进行通信，使用的是真实的网卡
	
### linux 网络环境查看命令 ###
关闭和启动网卡
#ifdown 网卡设备名 // 禁用该网卡设备
#ifup 网卡设备名 // 启用该网卡设备

查询网络状态
#netstat 选项

linux 远程服务器默认最大可连接 255
#netstat -an | grep ESTABLISHED //查看正在连接数
#netstat -rn // -r 列出路由列表，功能和 route 命令一致

route 命令
#route -n // 查看路由列表(可以看到网关)
#route add default gw 192.168.1.1 // 临时设定网关,必须要同网段

域名解析命令
#nslookup [主机名或IP] // 进行域名和IP地址解析
#nslookup  >server // 查看本机 DNS 服务器

### 网络测试命令 ###
#ping [选项] ip或域名 // 探测指定IP或域名的网络状况
	-c 次数 ：指定 ping 包的次数

ping 使用 ICMP 协议
输出结果：
！ 成功
. 未收到任何报文
U icmp 不可到达目的主机
N icmp 不可到达目的网络
P icmp 不可到达目的端口
Q icmp 源地址失踪
M icmp 禁止数据包分段
? 接收无法识别的数据包

#telnet [域名或IP] [端口] //远程管理或端口探测命令
#telnet 192.168.0.252 80 // 查看端口是否开启

#traceroute [选项] IP或域名 // 路由跟踪命令
 -n 使用IP，不使用域名，速度更快
 使用 ICMP 协议[Internet控制报文协议]，进行远程探测

#wget url //下载命令

#tcpdump -i eth0 -nnX port 21 // 抓包命令
	-i 指定网卡接口
	-nn 将数据包中的域名与服务转为 IP 和 端口
	-X 以十六进制和 ASCII 码显示数据包内容
	port 指定监听的端口


### 远程登录 ###
ssh 协议原理
ftp、telnet 都是通过明文传递的

对称加密算法：加密和界面都是相同的密钥
非对称加密算法：需要两个密钥，公开密钥和私有密钥

ssh 安全外壳协议  
首次远程连接会下载主机的公钥到本地 ~/.ssh/hnown_bosts

#scp [-r] 用户名@ip:文件路径 本地路径 // 下载文件
#scp [-r] 本地文件 用户名@ip:上传路径 // 上传文件











































end
