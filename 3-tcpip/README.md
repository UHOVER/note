物理传输介质

### 物理层
定义电气特性
Hosts->Hub
Hub
	功能：将终端的PC连接在一起
	工作原理: 收到数据后，发到所有连接改Hub的PC
	所有数据的冲突域、广播域、共享带宽
	Hub所有的端口都在同一个冲突域、广播域、共享带宽
CSMA/CD 传输数据(解决共享带宽问题)
	传送封装包(PC端过来的数据包或者返回的排队的数据包)-> 是否有空闲 -> I-否 -> 返回排队
    -> I-是 -> 空档持续 96bit-time -> II-否  -> 返回排队
    -> II-是  -> 送出封装包 -> 是否发送碰撞 -> III-否 -> 发送完毕
    -> III-是 -> 通知大家 -> 碰撞16次 -> IIII-否  -> 返回排队
    -> IIII-是 -> 放弃传送，通知上层

同类设备用交叉线，异类设备用直通线
DCE(数据通讯设备): 交换机、网桥、集线器、不带路由的modem
DTE(数据终端设备): PC、SERVER、路由器、带路由的modem
### 数据链路层
Hosts->Hub->交换机

交换机三大功能：地址学习、转发过滤、消除回路

交换机的工作原理(交换机接收数据如何处理)
当交换机接收到数据后,首先地址学习:将收到的帧的源MAC地址与进入端口编号相关联，放入 CAM 表中，然后取出目的 MAC 地址，查看是否是交换机本身的，如果是，自己留下处理，否则，将再次查看 CAM 表，如果 CAM 表中有对应的条目，将数据按照条目指定的端口转发出去，否则，将泛洪[所有连接交换机的端口转发出去]。
泛洪后续: PC接收到泛洪数据后，先解析帧数据，发现目标MAC地址不是自己的，将丢弃；是自己的，然后接收解析后，回复，交换机接收到回复，将MAC地址与端口编号关联，放入 CAM 表。不泛洪的话，没有回复这一步

转发与过滤：当交换机接收到数据发现源和目标 MAC 地址都在一个目标端口时，直接丢弃。[是因为在同一目标端口的数据在 Hub 已经泛洪]
消除回路: 

CAM 表：初始是空的，并且300秒刷新

####################################################################
### 应用层
File Transfer(文件传输): TFTP、FTP、NFS
E-Mail: SMTP
Remote Login(远程登录):Telnet、rlogin
Network Management(网络): SNMP
Name Management(名称管理协议):DNS

### 传输层
1B(byte,字节) = 8 b(bit,比特)

TCP报文格式
位置 名称(英文名) 					  长度/比特(bit)
1：	源端口(Source port)		 	  16			
2： 目标端口(Destination port)      16			
__________________________________________________________________
源端口随机生成，在1024--49151 之间
(源端口和目标端口)端口数: 2^16 = 65536
0--1023 : 		公认端口号 (80[www],21[ftp],23[telnet]...)
1024--49151:    注册端口号(个人公司服务)
49152--65536：   私有端口号(研究)
__________________________________________________________________
3:  顺序号(Sequence number)		  32
4:  确认号(Acknowledgement number) 32
__________________________________________________________________
顺序号、确认号：实现数据的确认重传
__________________________________________________________________
5： 头长度(Header length) 		  4
6： 保留位(Reserved) 				  6
7： 代码位(Code bits)				  6
8： 窗口(Window) 					  16
__________________________________________________________________
窗口：发送方和目的方协商一次发送多少数据
__________________________________________________________________
9： 校验和(Checksum) 				  16
__________________________________________________________________
校验和：检验报文是否有损坏
__________________________________________________________________
10：紧急指针(Urgent) 				  16		
__________________________________________________________________	
1--10：从上面到这里固定长度20 Bytes
__________________________________________________________________
11：选项(Options) 			0 or 32 if any
12：数据(Data) 					varies
__________________________________________________________________
数据：上层传送来的数据
__________________________________________________________________


# TCP 可靠传输机制--三次握手建立连接 
	Host A					  			Host B
1   Send SYN					-->   	SYN received
	(seq=100,ctl=SYN)  
	[ctl 发送的是同步信息]
	[seq 顺序号，随机产生,100]
2	SYN received				<--	  	Send SYN,ACK
							  			(Seq=300 ack=101 ctl=syn,ack)
							  			[ctl 发送同步确认信息，要求同步]
							  			[seq 顺序号，随机产生,300]
							  			[ack 确认号，是 A的 seq+1,101]
3	Established					-->		B收到后三次握手确认成功
	(seq=101 ack=301 ctl=ack)  
	[ctl 发送确认信息，确认同步]
	[seq 顺序号，B的ack,101]
	[ack 确认号，是 B的 seq+1,301]

# TCP 可靠传输机制--确认重传(假如Window Size = 1 [发送数据量是1])
含义:发送一个报文段，会这个报文段设置一次计时器，超时没收到确认时，重传该报文
发生阶段: 从握手开始，到TCP传输结束，整个生命周期都存在重传
	sender								Receiver
	Send 1(发送数据1)				-->		Receive 1(接收1)
	接收要求						<--		Send ACK 2(要求发送数据2)
	Send 2(发送数据2)				-->		Receive 2(接收2)
	接收要求						<--		Send ACK 3(要求发送数据3)
	...
	end(数据传完)

假设 1028 端口 向 23 端口发送数据包
格式: Soucre|Dest.|Sequence|Ack.|...
	Host A [1028] 						Host B [23]
	1028|23|10|0|...			-->	
	[Soucre、Sequence:随机产生 Ack.: 暂时还没有]	
								<--		23|1028|1|11|...
	1028|23|11|2|...			-->		
								<--		23|1028|2|12|...

# TCP 可靠传输机制--窗口流控[Window Size](假设 Receiver Window Size = 2)
含义:通过 Receiver 缓存的大小，调整 Window Size
	sender								Receiver
	WindowSize=3				-->		R
	Send 1
	WindowSize=3				-->		R
	Send 2
	WindowSize=3				-->		x(丢弃 Send 3)
	Send 3
	[一次发送三个数据包，发送滑动窗口为3]		[接收者缓存只有2，会丢弃3]
								<-- 	Ack 3
										Window size = 2
										[请求第三个报文段，并告诉发送者Window size = 2]
	WindowSize=2				-->		R
	Send 3
	WindowSize=3				-->		R
	Send 4
	[调查Window size，调整发送量]







end