物理传输介质

### 物理层
定义电气特性
Hosts->Hub
Hub
	功能：将终端的PC连接在一起
	工作原理: 收到数据后，发到所有连接改Hub的PC
	所有数据的冲突域、广播域、共享带宽
	Hub所有的端口都在同一个冲突域、广播域、共享带宽
CSMA/CD 传输数据(解决共享带宽问题)
	传送封装包(PC端过来的数据包或者返回的排队的数据包)-> 是否有空闲 -> I-否 -> 返回排队
    -> I-是 -> 空档持续 96bit-time -> II-否  -> 返回排队
    -> II-是  -> 送出封装包 -> 是否发送碰撞 -> III-否 -> 发送完毕
    -> III-是 -> 通知大家 -> 碰撞16次 -> IIII-否  -> 返回排队
    -> IIII-是 -> 放弃传送，通知上层

同类设备用交叉线，异类设备用直通线
DCE(数据通讯设备): 交换机、网桥、集线器、不带路由的modem
DTE(数据终端设备): PC、SERVER、路由器、带路由的modem
### 数据链路层
Hosts->Hub->交换机

交换机三大功能：地址学习、转发过滤、消除回路

交换机的工作原理(交换机接收数据如何处理)
当交换机接收到数据后,首先地址学习:将收到的帧的源MAC地址与进入端口编号相关联，放入 CAM 表中，然后取出目的 MAC 地址，查看是否是交换机本身的，如果是，自己留下处理，否则，将再次查看 CAM 表，如果 CAM 表中有对应的条目，将数据按照条目指定的端口转发出去，否则，将泛洪[所有连接交换机的端口转发出去]。
泛洪后续: PC接收到泛洪数据后，先解析帧数据，发现目标MAC地址不是自己的，将丢弃；是自己的，然后接收解析后，回复，交换机接收到回复，将MAC地址与端口编号关联，放入 CAM 表。不泛洪的话，没有回复这一步

转发与过滤：当交换机接收到数据发现源和目标 MAC 地址都在一个目标端口时，直接丢弃。[是因为在同一目标端口的数据在 Hub 已经泛洪]
消除回路: 

CAM 表：初始是空的，并且300秒刷新

####################################################################

数据封装和解封装
			Host A					  						Host B
应用层		data 											data
		 	|												^
		 	V 												|
传输层		TCP头|data [数据段]								TCP头|data
		 	|												^
		 	V 												|
互联网层		IP头|TCP头|data [数据包]							IP头|TCP头|data
		 	|												^
		 	V 												|
数据链路层 	帧头|IP头|TCP头|data|帧尾							帧头|IP头|TCP头|data|帧尾
		 	|												^
		 	V 												|
物理层		0101010101					---[网线等]-->		0101010101	

### 应用层
File Transfer(文件传输): TFTP、FTP、NFS
E-Mail: SMTP
Remote Login(远程登录):Telnet、rlogin
Network Management(网络): SNMP
Name Management(名称管理协议):DNS

### 传输层
TCP/UDP

1B(byte,字节) = 8 b(bit,比特)

## TCP报文格式
位置 名称(英文名) 					  长度/比特(bit)
1：	源端口(Source port)		 	  16			
2： 目标端口(Destination port)      16			
3:  顺序号(Sequence number)		  32
4:  确认号(Acknowledgement number) 32
5： 头长度(Header length) 		  4
6： 保留位(Reserved) 				  6
7： 代码位(Code bits)				  6
8： 窗口(Window) 					  16
9： 校验和(Checksum) 				  16
10：紧急指针(Urgent) 				  16		
11：选项(Options) 			0 or 32 if any
12：数据(Data) 					varies
__________________________________________________________________
源端口随机生成，在1024--49151 之间
(源端口和目标端口)端口数: 2^16 = 65536
0--1023 : 		公认端口号 (80[www],21[ftp],23[telnet]...)
1024--49151:    注册端口号(个人公司服务)
49152--65536：   私有端口号(研究)

顺序号、确认号：实现数据的确认重传
窗口：发送方和目的方协商一次发送多少数据
校验和：检验报文是否有损坏
数据：上层传送来的数据	
1--10：从上面到这里固定长度20 Bytes
__________________________________________________________________

# TCP 可靠传输机制--三次握手建立连接 
	Host A					  			Host B
1   Send SYN					-->   	SYN received
	(seq=100,ctl=SYN)  
	[ctl 发送的是同步信息]
	[seq 顺序号，随机产生,100]
2	SYN received				<--	  	Send SYN,ACK
							  			(Seq=300 ack=101 ctl=syn,ack)
							  			[ctl 发送同步确认信息，要求同步]
							  			[seq 顺序号，随机产生,300]
							  			[ack 确认号，是 A的 seq+1,101]
3	Established					-->		B收到后三次握手确认成功
	(seq=101 ack=301 ctl=ack)  
	[ctl 发送确认信息，确认同步]
	[seq 顺序号，B的ack,101]
	[ack 确认号，是 B的 seq+1,301]

# TCP 可靠传输机制--确认重传(假如Window Size = 1 [发送数据量是1])
含义:发送一个报文段，会这个报文段设置一次计时器，超时没收到确认时，重传该报文
发生阶段: 从握手开始，到TCP传输结束，整个生命周期都存在重传
	sender								Receiver
	Send 1(发送数据1)				-->		Receive 1(接收1)
	接收要求						<--		Send ACK 2(要求发送数据2)
	Send 2(发送数据2)				-->		Receive 2(接收2)
	接收要求						<--		Send ACK 3(要求发送数据3)
	...
	end(数据传完)

假设 1028 端口 向 23 端口发送数据包
格式: Soucre|Dest.|Sequence|Ack.|...
	Host A [1028] 						Host B [23]
	1028|23|10|0|...			-->	
	[Soucre、Sequence:随机产生 Ack.: 暂时还没有]	
								<--		23|1028|1|11|...
	1028|23|11|2|...			-->		
								<--		23|1028|2|12|...

# TCP 可靠传输机制--窗口流控[Window Size](假设 Receiver Window Size = 2)
含义:通过 Receiver 缓存的大小，调整 Window Size
	sender								Receiver
	WindowSize=3				-->		R
	Send 1
	WindowSize=3				-->		R
	Send 2
	WindowSize=3				-->		x(丢弃 Send 3)
	Send 3
	[一次发送三个数据包，发送滑动窗口为3]		[接收者缓存只有2，会丢弃3]
								<-- 	Ack 3
										Window size = 2
										[请求第三个报文段，并告诉发送者Window size = 2]
	WindowSize=2				-->		R
	Send 3
	WindowSize=3				-->		R
	Send 4
	[调查Window size，调整发送量]

## UDP 报文格式
位置 名称(英文名) 					  长度/比特(bit)
1：	源端口(Source port)		 	  16			
2： 目标端口(Destination port)      16	
3： 长度(length)					  16
4： 校验和(Checksum) 				  16
5： 数据(Data) 					if any
__________________________________________________________________	
1--4：从上面到这里固定长度8 Bytes
__________________________________________________________________

### 网际互联层
IP、ICMP、ARP、RARP

## IP 报文格式
位置 名称(英文名) 					  			长度/比特(bit)
1：	版本(Version)		 	  				4	
2：	头长度(Header Length)		 	  			4	
3：	优先级及服务类型(Priority&Type of Sevice)	8	
4：	总长度(Total Length)		 	  			16	
5：	标识(Identification)		 	  			16	
6：	标志(Flags)		 	  					3	
7：	段偏移(Fragment offset)		 	  		13	
8：	存活时间(Time to live)		 	  		8	
9：	协议(Protocol)		 	  				8	
10：	头校验和(Header checknum)		 	  		16	
11：	源IP地址(Source IP Address)		 	  	32	
12：	目的IP地址(Destination IP Address)		32	
13：	选项(Options)		 	  			0 or 32 if any	
14：	数据(Data)		 	  				varies if any
__________________________________________________________________
优先级及服务类型：服务类型QOS
标识、标志、段偏移：数据包分段用，当上层传下来的数据包比较大，经过的网络的MTU 较小，这时需要数据包分段。用这三个进行分段
存活时间(TTL):防止数据包在网络中无限传输,TTL值，这个值每经过一个路由器将会减1，路由器接收到 TTL 值为 0 的数据包将直接丢掉
协议：上层协议，TCP、UDP、ICMP
数据：传输层传下来的数据包
1--12：从上面到这里固定长度20 Bytes
__________________________________________________________________	

## ICMP 协议[因特网控制报文协议]
不同报文
1、目的不可达ICMP协议(目的网络、主机、协议、端口，不可达[到达目的找不到])
2、超时ICMP报文
3、重定向ICMP报文(向源主机通知更好的路由)
4、ICMP回应请求和回应应答(ping 是ICMP 协议)

ICMP 协议 -- ping 
ping 成功说明：
1、源到目的节点，目的到源节点 都存在工作路径，目标IP对应的机器正常工作
2、源到目的的路径与目的到源的路径可能不一致，即不对称路由

ICMP 协议 -- Traceroute
测试网络连通性和测试从源到目的地址的详细路径(经过的路由器)
原理:(默认最多发送30次)
发送第一次，TTL=1 源-> 路由器1 TTL-1 -> TTL == 0， 丢弃，向源发送 ICMP 超时 -> 源记录 路由器1 地址
发送第二次，TTL=2 源-> 路由器1 TTL-1 转发给路由器2 ->  路由器2 TTL-1 -> TTL == 0， 丢弃，向源发送 ICMP 超时 -> 源记录 路由器2 地址
发送第N次，TTL=N 源-> 路由器1 TTL-1 转发给路由器2 ->  路由器2 TTL-1 ... 转发给路由器N-> TTL == 0， 丢弃，向源发送 ICMP 超时 -> 源记录 路由器N 地址
发送第N+1次，TTL=N+1，目的地址不认识的包 -> ... -> 到达目的地，目的节点向源发送目的不可达ICMP协议，源知道自己到达最终目标
源知道各个路由器的地址 
每次发送，三个数据包，接收到一份返回的 ICMP 报文，打印一个往返时间，如果5s内扔未收到3份数据包的任何一份响应，则打印一个星号

## ARP 协议[地址解析协议]
作用：通过对方的IP地址来获取对方的MAC地址
数据从高层封装到数据链路层，需要封装目的MAC，由于源设备不知道目的MAC地址，需要通过ARP获取目的地址(向网络广播寻求目的IP对应的目标MAC地址)

## RARP 协议[反向地址解析协议]
作用：将MAC地址映射为IP地址
当PC不知道自己的IP地址时，通过向广播发送网络信息，寻求提供IP地址
例：无盘工作站，(PC关机IP 地址都存在硬盘中，没有操作系统和硬盘的PC，在启动时，向网络广播，寻求IP地址，当无盘工作站接收到广播时，向数据库查找该PC的MAC地址对应的IP地址，返回给PC，PC使用IP地址和无盘工作站进行通信，下载操作系统，安装启动)

## IP地址分类
网络位[网段]+主机位=32=IP地址
---------------------------------------------------------------------------------------------------
网络类型 |	最大网络数	|	IP地址范围					| 最大主机数 |	私有IP地址范围
---------------------------------------------------------------------------------------------------
	A   | 126(2^7-2)	| 1.0.0.0--126.255.255.255		| 2^24-2    | 10.0.0.0--10.255.255.255
	B   | 16384(2^14)	| 128.0.0.0--191.255.255.255	| 2^16-2	| 172.16.0.0--173.31.255.255
    C   | 2097152(2^21)	| 192.0.0.0--223.255.255.255	| 2^8-2		| 192.168.0.0--192.168.255.255
    D   | 				| 224.0.0.0--239.255.255.255	| 			| 
    E   | 				|  								| 			|  
---------------------------------------------------------------------------------------------------
私有地址不能在公网使用，在企业内部使用
IP地址 127.x.x.x：本地回环(loopback)测试地址
广播地址:255.255.255.255(所有主机)
IP地址0.0.0.0:代表任何网络
某网段的主机位全是0的(x.0.0.0)：网络本身(Network ID),本网络的网络地址，不能分配
某网段的主机位全是1的(x.255.255.255)：当前网络的广播地址，不能分配
最大主机数：2^N-2,其中的2一个是网络地址本身，一个是广播地址

各类IP地址二进制的特征		|所占总数百分百|范围:
A: 0---(0开头的所有IP)  	| 1/2 		  [1--126,因为0和127是保留位]
B: 10--(10开头的所有IP) 	| 1/4 		  [128--191]
C: 110-(110开头的所有IP)  | 1/8 		  [192--223]
D: 1110(110开头的所有IP)  | 1/8 		  [224--239]

## IP 子网划分 -- 子网掩码
原理：将网络位变长，主机位变短。将一个大网络划分为多个小网络
子网掩码:区分网络位和主机位(二进制中，子网掩码1对应的是网络位，子网掩码是0对应主机位)
子网位=现网络位-原网络位=原主机位-现主机位
子网数=2^子网位 
主机数：2^主机位-2
所有子网: (规则) 原网络位不变，现在主机位全0，子网位从全0到全1
192.168.10.0/27[IP/网络位数]
网络地址：第一个IP地址
广播地址：最后一个IP地址

将一个C类网络 192.168.10.0 划分多个子网，要求至少22台主机，最多划分多少个子网，子网掩码是多少,写出所有子网
22 < 32-2 (2^5=32),即主机位为5位。
子网划分:2^N [N = 8(原来主机位) - 5(现在主机位) = 3]  = 8个子网
子网掩码: 后面8位为 111000(二进制) = 224 -> 255.255.255.224
所有子网:
	192.168.10.[000 00000] -> 192.168.10.0/27
	192.168.10.[001 00000] -> 192.168.10.32/27
	...
	192.168.10.[111 00000]

















end